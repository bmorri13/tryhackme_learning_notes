# Authentication
- Write ups to include lessons learned and some answers for what the THM labs involve

## JWT Security - Write Up

### Token-Based Authentication
- Uses a client side JWT token instead of cookie based auth
- After auth, the token is provided in the header with each request (e.g. stored in browers LocalStorage for use)
- On new requests, the JS code laods in the token from storage and attaches it in the header
    - E.g.: `Authorization: Bearer`
- NOTE: This does not use the browsers cookie features.

- API Examples:

#### Request JWT Token
```bash
Authorization: Bearer
```

#### Authorized Request example:
```bash
curl -H 'Authorization: Bearer [JWT token]' http://MACHINE_IP/api/v1.0/example2?username=Y
```

### JSON Web Tokens

#### JWT Structruie
##### Token-Based Authentication
- **Header** - The header usually indicates the type of token, which is JWT, as well as the signing algorithm that is used.
    - Contains `alg` Algorithim types
    - Contains `typ` type?
- **Payload** - The payload is the body of the token, which contain the claims. A claim is a piece of information provided for a specific entity. In JWTs, there are registered claims, which are claims predefined by the JWT standard and public or private claims. The public and private claims are those which are defined by the developer. It is worth knowing the different between public and private claims, but not for security purposes, hence this will not be our focus in this room.
    - Contains information about the auth session the user is using
        - E.g. Claims for thigns such as `name`, `email`, `role`, etc.
- **Signature** - The signature is the part of the token that provides a method for verifying the token's authenticity. The signature is created by using the algorithm specified in the header of the JWT. Let's dive a bit into the main signing algorithms.
    - Contains things such as `HMAC`, `base64 encoded payload and secret`, etc.

##### Signing Algorithms
- **None** - The None algorithm means no algorithm is used for the signature. Effectively, this is a JWT without a signature, meaning that the verification of the claims provided in the JWT cannot be verified through the signature.
- **Symmetric Signing** - A symmetric signing algorithm, such as HS265, creates the signature by appending a secret value to the header and body of the JWT before generating a hash value. Verification of the signature can be performed by any system that has knowledge of the secret key.
    - E.g. `HS256`
- **Asymmetric Signing** - An asymmetric signing algorithm, such as RS256, creates the signature by using a private key to sign the header and body of the JWT. This is created by generating the hash and then encrypting the hash using the private key. Verification of the signature can be performed by any system that has knowledge of the public key associated with the private key that was used to create the signature.
    - E.g. `RS256`

##### Security in the Signature
- JWT can be encrypted, then being called `JWE's`, Once the JWT is signed, it can be sent to the client where it is needed. Cn then be used on necessary apps / API's and allows the signature to be verifed and provied access 

### Sensitive Information Disclosure
- In the lab, tested out modifying the JWT token Header and payload elements in order to force an Admin JWT token and then use the admin user to request and get access
    - In the header, tested removing the alg to None to test functionality 

### JWT Lifetimes
- Needs to be set to have the tokene expire so that it does not live forever
- Think of a banking app, that should have a faster expiration time on it then compared to a social media login for example

### Cross-Service Relay Attacks
- This allows us to set certain audience claims to a token in order to not allow it to hit certain features on a backend (e.g. an admin service / API feature but). So say a user can get a claim to the application but not the admin panel

#### Audience Claim
- NOTE: The claim for this must be set on the application itself and NOT the Authentication server for this to function.
    - If not, the token will be valid through signatrue verification when its not meant to be
- Tested out using the admin claims on different endpoints. App A we were able to claim the admin token with the admin flag override here sicne the Audience claim was not set
